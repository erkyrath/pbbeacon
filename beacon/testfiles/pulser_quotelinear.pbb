/// pulser
///   maxcount=1
///   interval=0.5
///   spaceshape=triangle
///   timeshape=flat
///   pos=quote: linear: -0.5, 0.5
///   width=0.1

var clock = 0   // seconds

var pulser_0_live = array(1)
var pulser_0_birth = array(1)
var pulser_0_livecount = 0
var pulser_0_nextstart = 0
var pulser_0_vector = array(pixelCount)

export function beforeRender(delta) {
  clock += (delta / 1000)
  for (var ix=0; ix<pixelCount; ix++) {
    pulser_0_vector[ix] = (0)
  }
  if (clock >= pulser_0_nextstart && pulser_0_livecount < 1) {
    for (var px=0; px<1; px++) {
      if (!pulser_0_live[px]) { break }
    }
    if (px < 1) {
      pulser_0_live[px] = 1
      livecount += 1
      pulser_0_nextstart = clock + 0.5
      pulser_0_birth[px] = clock
    }
  }
  for (var px=0; px<1; px++) {
    if (!pulser_0_live[px]) { break }
    age = clock - pulser_0_birth[px]
    timeval = 1
    ppos = (-0.5 + age * 0.5)
    pwidth = 0.1
    if (ppos-pwidth/2 > 1.0) {
      pulser_0_live[px] = 0
      livecount -= 1
      continue
    }
    minpos = max(0, pixelCount*(ppos-pwidth/2))
    maxpos = min(pixelCount, pixelCount*(ppos+pwidth/2))
    for (var ix=minpos; ix<maxpos; ix++) {
      relpos = ((ix/pixelCount)-(ppos-pwidth/2)) / pwidth
      spaceval = triangle(relpos)
      pulser_0_vector[ix] += (timeval * spaceval)
    }
  }
}

export function render(index) {
  var val = clamp(pulser_0_vector[index], 0, 1)
  rgb(val*val, val*val, val*val)
}

